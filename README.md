# Тестовое задание

## Как запустить

Для запуска необходимо, чтобы был установлен docker.

Для загрузки проекта с docker hub необходимо в командной строке прописать следующую команду:

```
    docker pull dearestman/messages:latest
```


Далее для запуска проекта необходимо ввести следующую комманду

```
     docker run -p <Порт на котором необходимо запустить программу>:8001 dearestman/messages   
```

пример:


```
     docker run -p 8001:8001 dearestman/messages   
```

Также если необходимо взять исходный код и развернуть проект - инструкция будет ниже.


## Общее описание

В качестве тестового задания необходимо реализовать REST API приложение с с автоирзацией через jwt токен  и с сохранением сообщений пользователя в бд

Добавить описание и инструкцию по запуску и комментарии в коде, если изменяете формат сообщений, то подробное описание ендпоинтов и их полей.

Необходимо также написать Unit тесты и код упаковать в контейнер Докера (не использовать порт 8080)

## Описание endpoints


### POST /auth/login
1.
Post запрос, который проверяет учетные записи пользователя, и если такой пользователь существует - отправляет ему jwtToken
Тип запроса: POST
Url: /auth/login
@param authenticationRequest
тело запроса:
body{
    "name": <Имя пользователя>,
    "password" : <Пароль>
}
@return
Формат ответа:
{
    "token": <сгенерированный для пользователя jwt token>
}
Срок токена 2 часа

**Responses**:

В случае успеха возвращает jwt token пользователя со сроком действия 2 часа

**_status 200_**

```
{
    "token": <jwt токен>
}
```

В случае если пользователя нет в бд

**_status 400_**
```
{
"message": "User not found",
"timestamp": <Время ошибки>
}
```

В случае некорректного пароля пользователя

**_status 400_**
```
{
"message": "Bad credentials",
"timestamp": <Время ошибки>
}
```


### POST /messages
2. 
Запрос, который добавляет сообщение пользователя в базу:

1. Если в теле запроса message = "history 10" - Возвращает последние 10 сообщение пользователя (в теле запроса name)
2. Иначе добавляет новое сообщения пользователя
3. Если пользователя не существует, выбрасывается исключения и в ответ приходит ошибка


Необходимо чтобы в запросе был заголовок:
<B>Authorization - со значением Bearer_<Актуальный JWT токен></B>
Тип запроса: POST
Url: /messages
@param userMessageRequest -
Тело запроса:
```
{
    "name" : <Имя пользователя>,
     "message" : <Сообщение: либо history 10, либо любое другое>
}
```

**Responses**:

В случае успешного добавления сообщения в бд

**_status 200_**


В случае если пользователя нет в бд

**_status 400_**
```
{
"message": "User not found",
"timestamp": <Время ошибки>
}
```

В случае несоответствия jwt токена и пользователя

**_status 400_**
```
{
"message": "Invalid token",
"timestamp": <Время ошибки>
}
```


## Работа с программой

### Инициализация БД

Создано 2 базы данных:
1. для работы приложения
2. для unit тестов

Базы данных находятся сейчас на хостинге, но если нужно подключить свою бд, необходимо:

1. отредактировать файлы application.properties и application-integrationtest.properties (добавить туда свою конфигурацию бд)
2. Создать 2 пустые базы данных (для приложения и для тестов)
3. Выполнить скрипт в этих базах данных, который находится в корне проекта c название SLQ 
ВАЖНО! (Скрипт для PostgreSQL версии старше 11, при необходимости необходимо оптимизировать его под свою СУБД)


### Работа с токеном безопасности jwt.

По условию задания, доступ к эндпоинту /messages осуществляется при помощи токена jwt. В токен должно записываться поле name.
Без заголовка Authorization со значением Bearer_<токен пользователя> - эндпоинт работать не будет.

Токен можно получить при помощи эндпоинта /auth/login .
