# JWT_Auth

## Как запустить

Для запуска необходимо, чтобы был установлен docker, docker-compose, а также docker был включен.

Для загрузки проекта с docker hub необходимо создать файл docker-compose.yml (файл находится в корне проекта):

```
version: '3'

services:
  postgres:
    image: 'postgres:13'
    container_name: 'inside-messages-postgres'
    environment:
      - 'POSTGRES_USER=postgres'
      - 'POSTGRES_HOST_AUTH_METHOD=trust'
      - 'POSTGRES_DB=messages'

  app:
    image: "dearestman/inside-messages"
    container_name: 'inside-messages'
    ports:
      - 8001:8001
```

При необходимости, можно выбрать свой порт, откорректировав файл docker-compose.yml:

```

  app:
    image: "dearestman/inside-messages"
    container_name: 'inside-messages'
    ports:
      - <Свой порт>:8001
```

Далее при помощи командной строки перейти в директорию, где находится данный файл и выполнить команду:

```
     docker-compose up -d   
```


Curl запросы для проверки находятся в корне проекта, в архиве: curl.zip

## Общее описание

В качестве тестового задания необходимо реализовать REST API приложение с авторизацией через jwt токен и с сохранением сообщений пользователя в бд

Добавить описание и инструкцию по запуску и комментарии в коде, если изменяете формат сообщений, то подробное описание ендпоинтов и их полей.

Необходимо также написать Unit тесты и код упаковать в контейнер Докера (не использовать порт 8080)

## Описание endpoints


### POST /auth/login
1.
Post запрос, который проверяет учетные записи пользователя, и если такой пользователь существует - отправляет ему jwtToken
Тип запроса: POST
Url: /auth/login
@param authenticationRequest
тело запроса:
body{
    "name": <Имя пользователя>,
    "password" : <Пароль>
}
@return
Формат ответа:
{
    "token": <сгенерированный для пользователя jwt token>
}
Срок токена 2 часа

**Responses**:

В случае успеха возвращает jwt token пользователя со сроком действия 2 часа

**_status 200_**

```
{
    "token": <jwt токен>
}
```

В случае если пользователя нет в бд

**_status 400_**
```
{
"message": "User not found",
"timestamp": <Время ошибки>
}
```

В случае некорректного пароля пользователя

**_status 400_**
```
{
"message": "Bad credentials",
"timestamp": <Время ошибки>
}
```


### POST /messages
2. 
Запрос, который добавляет сообщение пользователя в базу:

1. Если в теле запроса message = "history 10" - Возвращает последние 10 сообщение пользователя (в теле запроса name)
2. Иначе добавляет новое сообщения пользователя
3. Если пользователя не существует, выбрасывается исключения и в ответ приходит ошибка


Необходимо чтобы в запросе был заголовок:
<B>Authorization - со значением Bearer_<Актуальный JWT токен></B>
Тип запроса: POST
Url: /messages
@param userMessageRequest -
Тело запроса:
```
{
    "name" : <Имя пользователя>,
     "message" : <Сообщение: либо history 10, либо любое другое>
}
```

**Responses**:

В случае успешного добавления сообщения в бд

**_status 200_**


В случае если пользователя нет в бд

**_status 400_**
```
{
"message": "User not found",
"timestamp": <Время ошибки>
}
```

В случае несоответствия jwt токена и пользователя

**_status 400_**
```
{
"message": "Invalid token",
"timestamp": <Время ошибки>
}
```



### POST /registration
2.
Запрос, добавляет нового пользователя в базу:

Тип запроса: POST
Url: /registration
@param 
Тело запроса:
```
{
    "name" : <Имя пользователя>,
     "password" : <Пароль>
}
```

**Responses**:

В случае успешного добавления пользователя в бд

**_status 200_**


В случае если пользователь уже есть в бд

**_status 400_**
```
{
"message": "User already exist",
"timestamp": <Время ошибки>
}
```


## Работа с программой

Для начала работы с программой рекомендуется создать хотяб одного пользователя при помощи эндпоинта: 
#### POST /registration



### Работа с токеном безопасности jwt.

По условию задания, доступ к эндпоинту /messages осуществляется при помощи токена jwt. В токен должно записываться поле name.
Без заголовка Authorization со значением Bearer_<токен пользователя> - эндпоинт работать не будет.

Токен можно получить при помощи эндпоинта /auth/login .
